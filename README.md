# Хакатон Evraz2.0, 17-19 февраля 2023, решение команды Foxhound
# FoxControl
<img width="1350" alt="image" src="https://user-images.githubusercontent.com/43291747/219932900-18266726-f1de-4b27-9398-4fba15f98a58.png">

Веб-интерфейс для рабочего места машиниста эксгаустера.
Сервис для приема и сохранения потока данных с эксгаустера и предоставления интерфейса доступа к этим данным. 

# Описание репозитория

- backend - папка с кодом backend части. В том числе с потребителем кафки и описанием базы данных. Backend реализован на FastAPI, база данных MongoDB
- compose - папка с Dockerfile
- frontend - папка с кодом клиентской части. Frontend реализован на VueJS с использованием фреймворка Vuetify3
- predictor - папка с кодом модели для предсказаний

# Алгоритм предсказания
Для предсказания выхода из строя эксгаустера используется регрессия временных рядов для амплитуды колебаний на подшипниках.

Сейчас для модели предсказания реализованы:
- Линейный тренд, который строится по MSE-метрике
- [Модель Холта-Уинтерса](https://en.wikipedia.org/wiki/Exponential_smoothing) с аддитивной сезонностью

Параметр сезонности для модели Холта-Уинтерса подбирался вручную по анализу временных рядов за последний месяц.

После предсказания прогнозируемой даты пересечения временного ряда заданного предупредительного значения, находится наискорейшая (по всем колебаниям - горизонтальным, вертикальным, аксиальный) дата и возвращается в качестве прогнозируемой даты выхода из строя подшипника в совокупности с причиной выхода из строя (типом колебаний)

# Инструкция по запуску

Демо решение расположено по адресу [foxhound-team.pro](https://foxhound-team.pro)

Для запуска локально, см. [Развертывание через docker-compose](#развертывание-через-docker-compose)

Документация по API доступна по пути [foxhound-team.pro/docs](https://foxhound-team.pro/docs)

# Развертывание через docker-compose
1. Установить [docker](https://docs.docker.com/engine/install/ubuntu/)
2. В папке compose создать файл .env и [заполнить](#описание-переменных-окружения) его в соответствии с примерами (.env.example)
3. Запустить команду docker compose up -d с правами суперпользователя
```bash
sudo docker compose up -d
```
5. Настроить внешний nginx, который будет пересылать все запросы на порт приложения

# Описание переменных окружения

## HTTP_PORT
Файлы: .env

Тип: целое число

Назначение: порт на котором будет крутиться приложение
## KAFKA_PASSWORD
Файлы: .env

Тип: строка

Назначение: пароль для kafka

# Команды docker-compose 
Все команды необходимо выполнять в папке compose
- Остановить все контейнеры
```bash
sudo docker-compose stop
```
- Перезапустить контейнер
```bash
sudo docker-compose restart {container_name}
```
- Запуск ipython
```bash
sudo docker-compose exec backend ipython
```

